var chatMessages = document.querySelector('.js-chat-messages')

document.querySelector('.chat-messages__scrolling-spinner').remove()

<% if @messages.present? %>
  var tempHTML = document.createElement('div')
  var collectionHTML = '<%= j(render partial: 'messages/message', collection: @messages, locals: { user: @user }) %>'
  tempHTML.innerHTML = collectionHTML
  Array.from(tempHTML.children).forEach(messageNode => chatMessages.prepend(messageNode))

  chatMessages.dataset.lastMessageId = <%= @messages.last.id %>
<% else %>
  chatMessages.dataset.scroll = false
<% end %>

<% if params[:last_message_id] %>
  if (chatMessages.scrollTop == 0) {
    var lastMessage = document.querySelector('[data-message-id="<%= params[:last_message_id] %>"]')
    lastMessage.scrollIntoView()
  }
<% else %>
  chatMessages.scrollTop = chatMessages.scrollHeight
<% end %>
